{% raw %}
<div ng-controller="GameController">
  <h2>
    Game {{current_game.id}}
  </h2>
  <div class="container rows">
    <div>
      <button ng-click="hide_current_game()">
        Hide game
      </button>
      <button ng-click="leave_current_game()" ng-if="is_in_current_game()">
        Leave game
      </button>
      <br>
      <button ng-click="resolve_turn()" ng-if="can_resolve_turn()">
        Resolve turn
      </button>
      <br>
      <button ng-click="ui.display_users = !ui.display_users"
              ng-if="is_in_current_game()" class="{{ui.display_users ?
              'toggled' : ''}}">
        Display users
      </button>
      <div ng-if="ui.display_users">
        Users:
        <ul>
          <li ng-repeat="user in current_game.users">
            <label>
            {{user.username}}
            {{current_game.owner_id == user.id ? '(owner)' : ''}}
            {{current_user.id == user.id ? '(you)' : ''}}
            </label>
            <ul>
              <li>
                <label>
                  Heap sum:
                </label>
                {{get_heap_sum(user.id)}}
              </li>
              <li ng-if="current_game_users[user.id].needs_to_choose_column"
                class="user_must_choose">
                Needs to choose a column for his card!
              </li>
              <li ng-if="has_chosen_card(user.id)">
                <label>
                  Chosen card:
                </label>
                Card {{current_game_user_chosen_cards[user.id].number}}
                ({{"&#128004;".repeat(current_game_user_chosen_cards[user.id].cow_value)}})
              </li>
              <li ng-if="!has_chosen_card(user.id)">
                <label>
                  Hasn't chosen a card yet
                </label>
              </li>
            </ul>
          </li>
        </ul>
      </div>
      <div ng-if="current_game.status == 0">
        Available bots:
        <ul>
          <li ng-repeat="bot in available_bots">
            {{bot.username}}
            <button ng-click="add_bot_to_current_game(bot.id)" ng-if="current_game.owner_id == current_user.id">
              Add to game
            </button>
          </li>
        </ul>
        <button ng-click="start_current_game()" ng-if="current_game.owner_id ==
        current_user.id">
          Start game
        </button>
      </div>
    </div>
    <div ng-if="current_game.status > 0">
      <div ng-if="is_in_current_game()">
        Your hand:
        <div class="container columns">
          <div ng-repeat="card in current_game_user_hand.cards"
            ng-click="choose_card(card.id)"
            class="card {{has_chosen_card(current_user.id) ? '' : 'chosable'}}">
            {{card.number}}
            <br>
            {{"&#128004;".repeat(card.cow_value)}}
          </div>
        </div>
        <div ng-if="!has_chosen_card(current_user.id)">
          Choose a card by clicking on it
        </div>
      </div>
      <div ng-if="is_in_current_game() && has_chosen_card(current_user.id)">
        Chosen card:
        <div class="container columns">
          <div class="card">
            {{current_game_user_chosen_cards[current_user.id].number}}
            <br>
            {{"&#128004;".repeat(current_game_user_chosen_cards[current_user.id].cow_value)}}
          </div>
        </div>
      </div>
      <div>
        Board:
        <div class="container columns">
          <div ng-repeat="column in current_game_columns">
            <div ng-repeat="card in column.cards" class="card">
              {{card.number}}
              <br>
              {{"&#128004;".repeat(card.cow_value)}}
            </div>
          </div>
        </div>
      </div>
    </div>
  <div>
</div>
{% endraw %}
